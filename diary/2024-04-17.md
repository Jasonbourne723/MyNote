## 单词

| word        | 中文            |
| ----------- | ------------- |
| traditional | 传统的、守旧的、习俗的   |
| macro       | 宏指令；巨大的、特别突出的 |

## 技术知识点

### cpu 高速缓存

时钟周期是衡量 cpu 速度的最小单位，单位时间内时钟频率越快，cpu 运算速度越快。由于摩尔定律，每隔一段时间，半导体芯片内的晶体管数量就会翻一倍，所以cpu的运算速度一直在快速增长，这就导致了cpu运算速度与内存读取速度（100ns）差距越来愈大。

为了减少 cpu-内存 速度差异带来的性能影响，现代 cpu 都会在 cpu 内部集成高速缓存模块，高速缓存一般有三级，L1、L2、L3。

- L1 为每个核心独有 速度最快，读取速度约为0.5ns，但是存储空间最小，一般为128kb-2mb。
- L2 为每个核心独有，存储空间约为 256kb-32mb
- L3 为所有核心共享，读取速度最慢，存储空间 1mb-128mb

利用局部性原理，一块数据被访问到，那么它附近的数据也有很大几率会被访问，为了提升缓存效率，cpu 从内存读取数据时，不会只取当前指令要用的数据，而是按缓存行读取，缓存行大小一般为  32-256字节，最常见为 64字节。

多线程并发环境下，多个核心对同一内存块读写时，需要使用缓存一致性协议来保证多核心间的缓存数据一致性。应尽量减少缓存一致性协议对性能造成的影响。
### 指令重排

为了提升程序运行效率，cpu会在不影响执行结果的情况下，进行指令重排。

指令重排虽然对单线程下的执行结果没有影响，但是在多线程并发环境下，可能会出现一些不可预测的问题。

 内存屏障机制，可以保证对内存操作顺序和一致性，预防指令重排在多线程环境下对程序的影响。

C# 中 Volitile关键字 告诉编译器字段的值可能会被多个线程改变，不要对该字段的访问进行优化。
 
c# 对象初始化的过程：

1. 在 栈内存为引用开辟空间 
2. 在 堆内存为对象开辟空间 
3. 对 对象的成员变量进行 默认初始化 //默认初始化为null 
4. 对 对象的成员变量进行 显示初始化 //赋予初始值 
5. 通过 构造方法对 对象的成员 变量赋值 
6. 对象初始化完毕，把对象地址赋值给引用变量


```c#
public class Example
{
	//防止指令重排对对象初始化过程的影响，使用volatile修饰 _instance
	private static volatile Example _instance;
	private static readonly object _locker = new object();
	private Example(){}
	private static Example GetInstance(){
		if ( _instance == null) {
			lock(_locker){
				if (_instance == nul){
					_instance = new Example();
				}
			}
		}
		return _instance
	}
}
```


